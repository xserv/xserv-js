<!DOCTYPE html>
<html>
  <head>
    <title>HTML5 Demo</title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="../xserv.js"></script>
    <link rel="stylesheet" type="text/css" href="custom.css">
  </head>
  
  <body>
    
    <div class="box">
      <span>
	<svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px">
	  <circle id="state" cx="10" cy="10" r="10" fill="red" />
	</svg>
      </span>
      <span>Connection status</span>
      <span>&nbsp;&nbsp;&nbsp;&nbsp;</span> 
      <span id="info">{}</span>
      <span>UserData</span>
    </div>
    
    <p><button id="connect">Connect</button> <button id="disconnect">Disconnect</button> <button id="clear">Clear</button></p>
    <p><input type="text" id="topic" placeholder="Topic"> <input type="text" id="event" placeholder="Event"> 
      <input type="text" id="user" placeholder="User"> <input type="text" id="pass" placeholder="Pass"></p>
    <p><input type="text" id="message" placeholder="Message"> <button id="trigger">Trigger</button>
      <button id="bind">Bind</button> <button id="private">Bind Private</button> <button id="unbind">Unbind</button> 
      <button id="presence">Presence</button> <button id="history">History</button></p>
    
    <p>Operation result</p>
    <pre id="output_op"></pre>
    <p>Message</p>
    <pre id="output"></pre>
    
    <script>
      $(document).ready(function() {
        $("#connect").click(function() {
           xserv.connect();
        });
        $("#disconnect").click(function() {
           xserv.disconnect();
        });
        $("#clear").click(function() {
           $('#output_op').html("");
           $('#output').html("");
        });
        
        $("#trigger").click(function() {
           xserv.trigger($("#topic").val(), $("#event").val(), $("#message").val());
        });
        $("#bind").click(function() {
           xserv.bind($("#topic").val(), $("#event").val());
        });
        $("#unbind").click(function() {
           xserv.unbind($("#topic").val(), $("#event").val());
        });
        $("#private").click(function() {
           xserv.bind($("#topic").val(), $("#event").val(),
             {user:$("#user").val(), pass:$("#pass").val()}
             // {endpoint:'http://localhost:4321/auth_user', user:$("#user").val(), pass:$("#pass").val()}
           );
        });
        $("#presence").click(function() {
           xserv.presence($("#topic").val(), $("#event").val());
        });
        $("#history").click(function() {
           xserv.historyById($("#topic").val(), $("#event").val(), 0, 5);
        });
        
	var xserv = new Xserv('qLxFC-1'); // app_id
	// xserv.setReconnectInterval(20000);
	
	xserv.addEventListener('open', function() {
           $('#state').attr('fill', 'green');
	});
	
	xserv.addEventListener('close', function() {
	    $('#state').attr('fill', 'red');
	});
	
	xserv.addEventListener('events', function(data) {
            var html = "<div class='row'>" + JSON.stringify(data) + "</div>";
            $(html).hide().prependTo('#output').fadeIn(1000);
        });
        
        xserv.addEventListener('events:op', function(data) {
            var html = "<div class='row'>" + JSON.stringify(data) + "</div>";
	    $(html).hide().prependTo('#output_op').fadeIn(1000);
            
            if (data.op == Xserv.BIND && data.rc == Xserv.RC_OK && Xserv.isPrivateTopic(data.topic)) {
               $("#info").text(JSON.stringify(xserv.user_data));
            }
	});
        
        xserv.bind(['milano', 'roma'], 'all');
        // xserv.bind('@milano', 'all', {user:'amatig', pass:'pippo'});
        xserv.connect();
      });
    </script>
    
  </body>
</html>
